!function(){function t(t){this.options=f({defaultRoute:"/",routes:{},beforeRouteChange:null},t||{}),this.routes=[];var e=this.options.routes||{};for(var r in e)e.hasOwnProperty(r)&&this.route(r,e[r])}var e=/\((.*?)\)/g,r=/(\(\?)?:\w+/g,n=/\*\w+/g,u=/[\-{}\[\]+?.,\\\^$|#\s]/g,o=/#(.*)$/,a=window,i=a.location,s=a.history,c="popstate",h=s.replaceState?c:"hashchange",f=function(t,e){for(var r in e)e.hasOwnProperty(r)&&void 0!==e[r]&&(t[r]=e[r]);return t},p=function(t){return t=t.replace(u,"\\$&").replace(e,"(?:$1)?").replace(r,function(t,e){return e?t:"([^/?]+)"}).replace(n,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},l=function(t,e){var r=t.exec(e).slice(1);return r.map(function(t,e){return e===r.length-1?t||null:t?decodeURIComponent(t):null})},d=function(t,e){return t&&t.replace(/#(.*)$/,"")+"#"+e},g=function(t,e,r){var n=d(i.href,e);h===c?s[r?"replaceState":"pushState"]({},document.title,n):r?i.replace(n):i.hash="#"+e},v=function(t){var e=t.match(o);return e?e[1]:""},R=function(t,e){return t&&t.replace(o,"")+"#"+e},_=t.prototype;_.getCurrentRoute=function(){return this._currentRoute},_.start=function(){if(this._started)return this;var t=this;return this._started=!0,this._run=function(e){return t.navigate(v(e.target.location.hash),{updateHash:!1})},a.addEventListener(h,this._run),t.navigate(v(i.href),{updateHash:!1}),t},_.stop=function(){return a.removeEventListener(h,this._run),this._started=!1,this},_.navigate=function(t,e){var r=this,n=r.options,u=!0;return r._currentRoute===t?r:(e=f({trigger:!0,updateHash:!0,replace:!1},e||{}),r._currentRoute=t,n.beforeRouteChange&&void 0!=r._currentRoute&&n.beforeRouteChange.call(r,t)===!1||(e.trigger?r.routes.forEach(function(e){e.route.test(t)&&(e.callback.apply(r,l(e.route,t)),u=!1)}):u=!1,u?n.defaultRoute&&i.replace(R(i.href,n.defaultRoute)):e.updateHash&&g(r,t,e.replace)),r)},_.route=function(t,e){return"string"==typeof t&&(t=p(t)),this.routes.unshift({route:t,callback:e}),this},"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define?define(function(){return t}):a.Router=t}();